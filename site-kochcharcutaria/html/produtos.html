<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/produtos.css">
    <title>Kosh Charcutaria</title>
</head>
<body>
    <header>
        <div class="contatos">
            <span class="numero">(45) 99999-999</span>
            <span class="email">koshcharcutaria@gmail.com</span>
        </div>

        <section>
              <a href="./index.html"> 
            <div class="logo">
                <img src="../src/logo.png" alt="Logo kosh charcutaria" class="logo_img">
            </a>
            </div>
        </section>

        <nav>
            <a href="./index.html">In√≠cio</a>
            <a href="#">Produtos</a>
            <a href="./sobre.html">Sobre</a>
            <a href="./revendas.html">Revendas</a>
        </nav>
        
    </header>

     <div class="title-produtos"><h3>Produtos</h3></div>

    <div class="container-produtos">
        
    </div>

    <script>
        const URL = "https://wy2dx8kh.api.sanity.io/v2025-11-17/data/query/production?query=*%5B_type+%3D%3D+%22produtosViewType%22%5D%7B%0A++Descricao%2C%0A++%22Endereco_da_imagem%22%3A+Endereco_da_imagem.asset-%3Eurl%2C%0A++Link_do_produto%2C%0A++Nome_do_produto%2C%0A++Percentual_de_desconto%2C%0A++Preco_do_produto%0A%7D&perspective=drafts"
        async function carregarProdutos() {

            const main = document.querySelector('.container-produtos');
            const sectionProd = document.createElement("section");

          
            let produtosCache = localStorage.getItem("produtosCache");
            if(produtosCache){
                console.log("Carregando os produtos...");
                produtosCache = JSON.parse(produtosCache);
                renderProdutos(produtosCache, sectionProd, main);   
                return;
            }
            
            
            
            console.log("Pegando da API");
            const response = await fetch(URL);
            const json = await response.json();
            const result = json.result;
            renderProdutos(result, sectionProd, main);

            localStorage.setItem("produtosCache", JSON.stringify(result));
            console.log("Produtos foram salvos no cache");
            

        }

        function renderProdutos(produtos, sectionProd, main){

            for (let element of produtos) {
                console.log(element);

                const img = document.createElement("img");
                img.src = element.Endereco_da_imagem;

                const divProd = document.createElement("div");
                divProd.classList.add("produtos");
                divProd.append(img);

                divProd.addEventListener("click", () => {
                    localStorage.setItem("produtoSelecionado", JSON.stringify(element));
                    window.location.href = "./acessoProduto.html";
                })

                sectionProd.append(divProd);
            }

            main.append(sectionProd);
        }

        carregarProdutos();
    </script>
   

    <div class="melhores-empresas"><h3>Estamos entre as melhores empresas do estado</h3></div>

    <div class="container-empresas">
        <section>
            <div class="empresa"><img src="" alt=""></div>
            <div class="empresa"><img src="" alt=""></div>
            <div class="empresa"><img src="" alt=""></div>
            <div class="empresa"><img src="" alt=""></div>
            <div class="empresa"><img src="" alt=""></div>
            <div class="empresa"><img src="" alt=""></div>
            <div class="empresa"><img src="" alt=""></div>
        </section>
        <div class="button"><button id="b3">Entre em contato!</button></div>
    </div>
        

    <footer>
        <div class="footer-content">
            <div class="imglogo-footer"><img src="../src/logo.png"> </div>
                    <p>(45) 99999-999</p> 
                    <p>Email: koshcharcutaria@gmail.com</p>
            <div class="footer-icons">
            <img src="../src/footer_zap.png"> <img src="../src/footer_insta.png"> <img src="../src/footer_face.png">
            </div>
        </div>
    </footer>
    
</body>
</html>